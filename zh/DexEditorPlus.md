# Dex编辑器++使用说明

Dex编辑器++是MT管理器2.2.0版本新增的功能，Dex处理库代码来自[JesusFreke/smali](https://github.com/JesusFreke/smali)，与之前的Dex编辑器基本没有任何联系，功能上也有许多差异。

> 本文仅仅是Dex编辑器++的使用说明，不涉及smali语法以及如何修改代码等方面内容。

## 入门指南

使用MT管理器打开任意dex文件，选择Dex编辑器++即可进入。

可以看到**浏览**、**最近**、**搜索**三个标签页

* 浏览界面采用树形方式进行浏览
* 最近界面记录最近打开的文件和被修改过的文件
* 搜索界面可进行搜索以及显示搜索结果

此时MT自动为我们创建了一个临时Dex工程，如果我们退出Dex编辑器，当前的修改内容都会丢失（包括修改的代码、最近打开的文件、搜索记录等内容），即使退出前编译了Dex，也只能将修改过的代码保存到Dex中。

现在这个问题在Dex编辑器++中已被完美解决，只需要点击左上角的菜单，选择**保存为工程**，保存成功后试着随便做些修改，直接退出（临时工程退出前会进行确认，现在不会有任何提示）。

返回到**主界面**后打开**侧拉栏**，就可以看到我们刚刚保存的**工程**了，点击直接打开工程，**长按则进入工程目录**，再次进入Dex编辑器++后可以看到之前的修改内容都还在。**注意这边是从侧拉栏打开工程，而不是打开之前的dex文件。**

完成修改后，点击左上角的菜单，选择**编译**，编译完成后保存在**工程目录/classes.dex**，如果是临时工程则会覆盖原来的dex文件。

## 编译说明

首先明确一个概念，之前的Dex编辑器的**保存**其实就是**编译**，为了防止修改过的内容丢失，退出前都要**保存**一下。而在Dex编辑器++中，保存为工程后，我们的修改在退出后是不会丢失的，所以不要认为退出前都要**编译**一下，什么都不用做，直接退出就行，不用担心会丢失什么。

Dex编辑器++采用差量编译，即修改过的类需要进行编译，而未修改的则从原dex文件中提取代码，编译速度上远远超过apktool，并且第一次打开dex时不会将所有类反编译成smali文件，只有在打开一个类时会根据需要再反编译，打开速度也非常快。

## 工程目录

所有工程均放在**SD卡/projects**文件夹中，无法修改。

进入工程目录后可以看到**data**和**smali**两个文件夹

* **data**放的是项目的一些数据，请不要自行修改以免发生无法预料的错误。
* **smali**放的是修改过的类的smali文件以及自行添加的smali文件。每个类只有被修改过它的smali文件才会出现在该目录中，所以一开始它是空的。

编译后的dex文件保存在**工程目录/classes.dex**，可以在工程目录中自行放其它文件，如apk文件以方便打包dex。

## 类名问题

初始化时，每个类都是根据它的类名和包名进行存放，当我们在smali代码中修改了一个类的类名或包名时，它的位置和名称并不会改变，实际还是以smali代码中的定义为准。

举个例子，浏览界面中打开com/android/example中的ClassA，在smali第一行定义了它的完整类名Lcom/android/example/ClassA;，将它改成Lcom/android/ClassB;并保存后，你可能以为它会移动到com/android中，并且名称变成ClassB，其实不会，你依旧需要在com/android/example中的ClassA打开它。

这个跟原Dex编辑器的设计思想上存在不同，如果不理解，就把它想成apktool的使用方式，你修改了一个smali文件中类的定义，改完后这个文件依旧在原来的位置不会动是一样的道理。

## 搜索功能

Dex编辑器++支持搜索字符串、方法名、整数、代码，可指定搜索路径、是否搜索子目录、是否区分大小写，支持正则表达式，支持在当前搜索结果中搜索，支持撤销搜索。

发起搜索的方式有两种，一是在搜索界面直接点击对应选项，二是在浏览界面长按文件夹，点击弹出菜单中的搜索。

### 搜索字符串和代码的区别

代码就是smali代码，字符串是smali代码中的"xxxxxx"，即引号中的内容

搜索代码的速度远远慢于其它搜索类型的搜索速度，为了节省搜索时间，在有很多类的情况下建议首次搜索不要搜索代码，先用其它搜索类型进行搜索，缩小范围后再使用**在当前结果中搜索**功能进行代码搜索。

## 常见问题

### 如何添加外部Smali文件到工程中？

直接丢到工程目录的smali内，不一定非要放到与包名对应的文件夹内，再次打开工程即可看到。

### 如何将Smali代码转成Java代码？

进入Smali代码编辑界面后，点击**转成Java**菜单即可将当前Smali代码转成Java代码，该功能需要开通VIP才能使用，Java代码无法修改，仅是用作参考。

如果是外部smali文件，可以先放到工程目录的smali文件夹，或者直接粘贴代码带编辑器中。

### 字符常量池功能在哪？

暂时没有该功能，如果需要请使用原Dex编辑器。


